Download and upload images for Audit service (EKS)
Make sure you have installed SMAX before installing Audit service.
Before you deploy the Audit service, you need to download the required audit and audit dependent images from Docker Hub or
other registries. Then upload the images to your registry.
If you have already uploaded images to your registry, skip this step.
Generate the Image Set
The generate_download_bundle.sh compares the images needed by the suite with the images that already exist in the cluster
and generates a .zip file, 
offline-download.zip
. This file enables you to download the required images from Docker Hub.
Give the AWS credentials if prompted:
./generate_download_bundle.sh --chart <Audit service Helm chart> -o <organization> -d <destination directory for the generated zip file>
For example:
./generate_download_bundle.sh --chart Audit_Helm_Chart-2022.11/audit-helm-charts/charts/audit-1.0.0+20221100.24.tgz -o hpeswitom -d /tmp
You can find the 
offline-download.zip
 under the current working directory unless you specify the "
-d
" option. You will
receive the following messages indicating that you have successfully generated the
 offline-download.zip
 file:
[INFO] 2020-07-31 17:58:46 : ** Generating the offline image download bundle ...
[INFO] 2020-07-31 17:58:50 : Completed generation of offline-download.zip in /tmp
Then, you can find the image set file 
image-set.json
 in the current directory. This file contains a list of the required images
and you will use it when you run the Python script to transfer the suite images in a later step.
Verify if you need to upload the images
Before you proceed to creating the ECR repositories and downloading and uploading the images, check if the 
image-set.json
generated by 
generate_download_bundle.sh
 script isn't empty. If 
generate_download_bundle.sh
 is empty, you don't
have to create ECR repositories or download and upload images. Follow these steps to verify that the 
image-set.json 
isn't
empty:
1
. 
Change the directory to the destination directory provided while running the 
generate_download_bundle.sh
 script:
cd /home/centos/audit-2022.11
2
. 
Unzip the 
offline-download.zip
 by running the following command:
unzip offline-download.zip
3
. 
Print the content of 
image-set.json
 present in the 
offline-download
 directory:
cat offline-download/image-set.json
Create ECR repositories
Before pushing images to Amazon Elastic Container Registry (ECR), you need to create a repository for each image. 
To do this, copy and save the script below as 
create_aws_repositories.py
 to 
OMT_External_K8s_202x.xx-xxx/scripts
 on
the bastion:
import os
import subprocess
import time
import sys
import json
import argparse
import logging
from collections import OrderedDict
from subprocess import CalledProcessError
logFile = os.path.dirname(os.path.realpath(__file__)) + '/create_aws_repositories.log'
if os.path.exists(logFile):
    os.remove(logFile)
logging.basicConfig(level=logging.DEBUG,
                    format='%(asctime)s %(name)-12s %(levelname)-8s %(message)s',
                    datefmt='%m-%d %H:%M', filename=logFile, filemode='w')
console = logging.StreamHandler()
console.setLevel(logging.INFO)
SMAX 2022.11
Page 
965
This PDF was generated on 25/02/2023 02:18:34 for your convenience. For the latest documentation, always see
https://docs.microfocus.com
.